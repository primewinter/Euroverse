<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="LikeMapper">
 	 	
	<resultMap id="likeSelectMap" type="like">
		<result property="likeId" 			column="like_id" 			jdbcType="VARCHAR"/>
		<result property="likeType"	column="like_type" 		jdbcType="CHAR" />
		<result property="refId" 	column="ref_id" 		jdbcType="VARCHAR" />
		<result property="likeUserId" 			column="like_user_id" 	jdbcType="VARCHAR" />
		<result property="likeCheck" 			column="like_check" 	jdbcType="CHAR" />
	</resultMap>
	
	<update id="like_check" parameterType="like">
	    UPDATE likes
	    <set>
	    	like_check = 'T'
	    </set> 
	    WHERE like_user_id = #{likeUserId} AND ref_id = #{refId} AND like_type = #{likeType}
	</update>
	
	<update id="like_check_cancel" parameterType="like">
		UPDATE likes
		<set>
			like_check = 'F'
		</set>
		WHERE like_user_id = #{likeUserId} AND ref_id = #{refId} AND like_type = #{likeType}
	</update>
	
	<select id="countByLike" parameterType="like" resultType="int">
	    SELECT COUNT(like_id)
	    FROM likes
	    WHERE like_user_id = #{likeUserId} AND ref_id = #{refId} AND like_type = #{likeType}
	</select>

	<select 	id="getLike"	parameterType="like"	resultMap="likeSelectMap">
		SELECT
		like_id , like_type , ref_id , like_user_id , like_check
		FROM likes
		WHERE like_user_id = #{likeUserId} AND ref_id = #{refId} AND like_type = #{likeType}
	</select>
	
	<select id="getRoomRefId" resultType="string">
		SELECT SEQ_room_room_id.CURRVAL FROM dual
	</select>
	
	<select id="getFlightRefId" resultType="string">
		SELECT SEQ_flight_flight_id.CURRVAL FROM dual
	</select>
	 
	<insert id="addLike" parameterType="like">
		INSERT INTO likes(like_id , like_type , ref_id , like_user_id , like_check) 
		<if test="refId != null">
		VALUES ( SEQ_likes_like_id.NEXTVAL , #{likeType} , #{refId} , #{likeUserId} , 'F' )
		</if>
		<if test="refId == null">
			<if test=' likeType.equals("R") '>
				VALUES ( SEQ_likes_like_id.NEXTVAL , #{likeType} , SEQ_room_room_id.CURRVAL , #{likeUserId} , 'F' )
			</if>
			<if test=' likeType.equals("F") '>
			VALUES ( SEQ_likes_like_id.NEXTVAL , #{likeType} , SEQ_flight_flight_id.CURRVAL , #{likeUserId} , 'F' )
			</if>
		</if>
    </insert>

</mapper>